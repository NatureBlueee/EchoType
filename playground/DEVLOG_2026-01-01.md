# GlimpseMe å¼€å‘æ—¥å¿— - 2026-01-01

> å®Œæ•´è®°å½•æœ¬æ¬¡ä¼šè¯çš„æ‰€æœ‰å·¥ä½œ

---

## ä¼šè¯æ¦‚è§ˆ

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å¼€å§‹æ—¶é—´** | 2026-01-01 12:31 |
| **ç»“æŸæ—¶é—´** | 2026-01-01 15:55 |
| **ä¸»è¦ç›®æ ‡** | 1. å®Œå–„ Windows ç‰ˆ GlimpseMe 2. ç§»æ¤åˆ° macOS |
| **å·¥ä½œæˆæœ** | Windows ç‰ˆæ•°æ®è´¨é‡æ”¹è¿› + macOS ç‰ˆå®Œæ•´é¡¹ç›®åˆ›å»º |

---

## Part 1: Windows ç‰ˆå®Œå–„ (12:31 - 15:30)

### 1.1 é¡¹ç›®ç°çŠ¶åˆ†æ

**å‘ç°**ï¼šé˜¶æ®µ 1-6 å·²å…¨éƒ¨å®Œæˆï¼Œä½† `IMPLEMENTATION_LOG.md` æœªæ›´æ–°

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| BrowserAdapter | `browser_adapter.h/cpp` | âœ… å·²å®ç° |
| WeChatAdapter | `wechat_adapter.h/cpp` | âœ… å·²å®ç° |
| VSCodeAdapter | `vscode_adapter.h/cpp` | âœ… å·²å®ç° |
| NotionAdapter | `notion_adapter.h/cpp` | âœ… å·²å®ç° |

### 1.2 æ–‡æ¡£æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶**: `playground/ClipboardMonitor/IMPLEMENTATION_LOG.md`

```diff
- é˜¶æ®µ3 | â³ å¾…å¼€å§‹
- é˜¶æ®µ4 | ğŸ“… è®¡åˆ’ä¸­
- é˜¶æ®µ5 | ğŸ“… è®¡åˆ’ä¸­
- é˜¶æ®µ6 | ğŸ“… è®¡åˆ’ä¸­
+ é˜¶æ®µ3 | âœ… å®Œæˆ | BrowserAdapter
+ é˜¶æ®µ4 | âœ… å®Œæˆ | WeChatAdapter
+ é˜¶æ®µ5 | âœ… å®Œæˆ | VSCodeAdapter
+ é˜¶æ®µ6 | âœ… å®Œæˆ | NotionAdapter
```

### 1.3 æµè§ˆå™¨æ‰©å±•éªŒè¯

**æ£€æŸ¥æ–‡ä»¶**:
- `browser_extension/manifest.json` - Manifest V3 âœ…
- `browser_extension/content.js` - å¤åˆ¶äº‹ä»¶æ•è· âœ…
- `browser_extension/background.js` - Service Worker âœ…
- `browser_extension/native_host/native_host.cpp` - åŸç”Ÿé€šä¿¡ âœ…
- `browser_extension/install.bat` - æ³¨å†Œè„šæœ¬ âœ…

**å‘ç°é—®é¢˜**: å›¾æ ‡æ–‡ä»¶ä½“ç§¯å¼‚å¸¸ (434KB/ä¸ª)

### 1.4 é…ç½®ç³»ç»Ÿè®¾è®¡

**åˆ›å»ºæ–‡ä»¶**: `playground/ClipboardMonitor/config_design.md`

å®šä¹‰äº† `config.json` ç»“æ„ï¼š
```json
{
  "adapters": {
    "browser": { "enabled": true, "timeout_ms": 5000 },
    "wechat": { "enabled": true },
    "vscode": { "enabled": true },
    "notion": { "enabled": true }
  },
  "output": {
    "include_pid": false,
    "include_process_path": false
  }
}
```

### 1.5 æ•°æ®è´¨é‡æ”¹è¿›

#### 1.5.1 WeChat é€‚é…å™¨ä¿®å¤

**ä¿®æ”¹æ–‡ä»¶**: `context/adapters/wechat_adapter.cpp`

**é—®é¢˜**: `GetRecentMessages()` è·å–çš„æ˜¯å·¦ä¾§å¯¹è¯åˆ—è¡¨è€Œéæ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆ**:
```cpp
// åŸä»£ç ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ª List
foundElements->GetElement(0, &listElement);

// ä¿®å¤åï¼šå¯å‘å¼é€‰æ‹©æ­£ç¡®çš„æ¶ˆæ¯åŒºåŸŸ
for (int i = 0; i < length && i < 10; i++) {
    // è·³è¿‡ç¬¬ä¸€ä¸ª Listï¼ˆé€šå¸¸æ˜¯å¯¹è¯åˆ—è¡¨ï¼‰
    // åŸºäºå­å…ƒç´ æ•°é‡å’Œ X ä½ç½®é€‰æ‹©
    if (i > 0 && childCount > 0 && width > 200) {
        // è¿™æ˜¯æ¶ˆæ¯åŒºåŸŸ
    }
}
```

#### 1.5.2 JSON è¾“å‡ºç²¾ç®€

**ä¿®æ”¹æ–‡ä»¶**: `storage.cpp`

```diff
- json << "      \"pid\": " << entry.source.processId;
- json << "      \"process_path\": \"...\"";
+ // ç§»é™¤å†—ä½™å­—æ®µ

+ // æ¡ä»¶ç”Ÿæˆ content_preview
+ if (contentUtf8.length() > 200) {
+     json << ",\n    \"content_preview\": \"...\"";
+ }
```

---

## Part 2: macOS ç§»æ¤ (15:45 - 15:55)

### 2.1 ç§»æ¤æ–¹æ¡ˆåˆ†æ

**æ ¸å¿ƒé—®é¢˜**: Windows UI Automation æ—  macOS ç­‰æ•ˆæ›¿ä»£

| Windows æŠ€æœ¯ | macOS æ›¿ä»£ |
|-------------|-----------|
| `AddClipboardFormatListener` | `arboard` crate |
| `UI Automation` | âŒ æ— ç­‰æ•ˆ |
| `Shell_NotifyIconW` | `tray-icon` crate |
| `%APPDATA%` | `~/Library/Application Support/` |

### 2.2 åˆ›å»º Rust é¡¹ç›®

**é¡¹ç›®ä½ç½®**: `playground/glimpseme/`

#### Cargo.toml
```toml
[dependencies]
arboard = "3.4"        # è·¨å¹³å°å‰ªè´´æ¿
tray-icon = "0.19"     # ç³»ç»Ÿæ‰˜ç›˜
serde_json = "1.0"     # JSON
chrono = "0.4"         # æ—¶é—´
core-graphics = "0.24" # macOS çª—å£ä¿¡æ¯
```

#### æ–‡ä»¶ç»“æ„
```
src/
â”œâ”€â”€ main.rs           # å…¥å£ + äº‹ä»¶å¾ªç¯
â”œâ”€â”€ clipboard.rs      # å‰ªè´´æ¿ç›‘æ§ï¼ˆè½®è¯¢ï¼‰
â”œâ”€â”€ storage.rs        # JSON å­˜å‚¨
â”œâ”€â”€ source_info.rs    # æ´»åŠ¨çª—å£è·å–
â””â”€â”€ tray.rs           # ç³»ç»Ÿæ‰˜ç›˜
```

### 2.3 æ ¸å¿ƒå®ç°

#### clipboard.rs - å‰ªè´´æ¿ç›‘æ§
```rust
pub fn check_for_changes(state: &Arc<Mutex<AppState>>) -> Option<ClipboardEntry> {
    let text = get_text()?;
    let hash = hash_string(&text);
    
    // æ£€æŸ¥æ˜¯å¦å˜åŒ–
    if state.lock().ok()?.last_clipboard_hash == hash {
        return None;
    }
    
    // è·å–æºåº”ç”¨
    let source = source_info::get_active_window_info();
    
    Some(ClipboardEntry { ... })
}
```

#### source_info.rs - macOS æ´»åŠ¨çª—å£
```rust
#[cfg(target_os = "macos")]
pub fn get_active_window_info() -> SourceInfo {
    // ä½¿ç”¨ Core Graphics API
    let windows = CGWindowListCopyWindowInfo(...);
    
    // éå†æ‰¾åˆ° layer == 0 çš„çª—å£
    // è·å– kCGWindowOwnerName å’Œ kCGWindowName
}
```

#### tray.rs - ç³»ç»Ÿæ‰˜ç›˜
```rust
pub fn create_tray(event_tx: Sender<TrayEvent>) -> Result<TrayIcon> {
    let menu = Menu::new();
    menu.append(&MenuItem::new("æš‚åœ/æ¢å¤", ...));
    menu.append(&MenuItem::new("æ‰“å¼€å†å²è®°å½•", ...));
    menu.append(&MenuItem::new("é€€å‡º", ...));
    
    TrayIconBuilder::new()
        .with_menu(Box::new(menu))
        .with_tooltip("GlimpseMe")
        .build()
}
```

---

## å¾…å®Œæˆäº‹é¡¹

### Windows ç‰ˆ
- [ ] ç¼–è¯‘æµ‹è¯• WeChat ä¿®å¤
- [ ] éªŒè¯ JSON ç²¾ç®€
- [ ] å®ç° `config.h/cpp`

### macOS ç‰ˆ
- [ ] å®‰è£… Rustï¼š`curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh`
- [ ] ç¼–è¯‘æµ‹è¯•ï¼š`cargo build --release`
- [ ] ä¿®å¤ç¼–è¯‘é”™è¯¯
- [ ] æµè§ˆå™¨æ‰©å±•é›†æˆ

---

## æ–‡ä»¶å˜æ›´æ€»è§ˆ

| æ“ä½œ | æ–‡ä»¶ |
|------|------|
| ä¿®æ”¹ | `ClipboardMonitor/IMPLEMENTATION_LOG.md` |
| ä¿®æ”¹ | `ClipboardMonitor/context/adapters/wechat_adapter.cpp` |
| ä¿®æ”¹ | `ClipboardMonitor/storage.cpp` |
| æ–°å»º | `ClipboardMonitor/config_design.md` |
| æ–°å»º | `glimpseme/Cargo.toml` |
| æ–°å»º | `glimpseme/src/main.rs` |
| æ–°å»º | `glimpseme/src/clipboard.rs` |
| æ–°å»º | `glimpseme/src/storage.rs` |
| æ–°å»º | `glimpseme/src/source_info.rs` |
| æ–°å»º | `glimpseme/src/tray.rs` |
